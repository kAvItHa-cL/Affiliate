@model EEAffiliate.AffiliateRegister


@{
    ViewBag.Title = "Settings";
    Layout = "~/Views/Shared/_Layout.cshtml";
}


<div class="smenu">
    <div class="menu">
        <div class="row" style="padding-left:20px;padding-top:20px;">
            <div class="col-lg-32 col-sm-62">
                <div class="card" id="card1">
                    <div class="content">
                        <div class="row">
                            <!-- <div class="col-xs-5"> -->
                            <!-- </div> -->
                            <!-- </div> -->
                            <!-- <div class="col-xs-7"> -->
                            <!-- <div class="numbers"> -->
                            <center>
                                <a id="setting1" onclick="return showLinks();" class="settings sm-settings" style="cursor:pointer;">
                                    <div class="icon-big icon-warning text-center" style="font-size:2em;">
                                        <i class="fa fa-link"></i>
                                    </div>
                                    Affiliate Links
                                </a>
                            </center>

                            <!-- </div> -->
                            <!-- </div> -->

                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-32 col-sm-62" style="width:32.5%;">
                <div class="card" id="card2">
                    <div class="content">
                        <div class="row">
                            <!-- <div class="col-xs-5"> -->
                            <!-- <div class="icon-big icon-success text-center" style="font-size:2em;"> -->
                            <!-- <i class="ti-wallet"></i> -->
                            <!-- <!-- </div> -->
                            <!-- </div> -->
                            <!-- <div class="col-xs-7"> -->
                            <!-- <div class="numbers"> -->
                            <center>
                                <a id="setting2" onclick="return showReset();" class="settings sm-settings" style="cursor:pointer;">
                                    <div class="icon-big icon-success text-center" style="font-size:2em;">
                                        <i class="fa fa-key"></i>
                                    </div>Reset Password
                                </a>
                            </center>

                            <!-- </div> -->
                            <!-- </div> -->
                        </div>
                        <div class="footer">
                            <!-- <hr /> -->
                            <!-- <div class="stats"> -->
                            <!-- <i class="ti-calendar"></i> Last day -->
                            <!-- </div> -->
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-32 col-sm-62" style="width:32.5%;">
                <div class="card" id="card3">
                    <div class="content">
                        <div class="row">
                            <!-- <div class="col-xs-5"> -->
                            <!-- </div> -->
                            <!-- <div class="col-xs-7"> -->
                            <!-- <div class="numbers"> -->
                            <center>
                                <a id="setting3" onclick="return showDetails();" class="settings sm-settings" style="cursor:pointer;">
                                    <div class="icon-big icon-danger text-center" style="font-size:2em;">
                                        <i class="fa fa-user-circle"></i>
                                    </div>
                                    User Details
                                </a>
                            </center>

                            <!-- </div> -->
                            <!-- </div> -->
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="content" style="padding-top:3px;">
    <div class="container-fluid">
        <div class="row">
            <div class="col-lg-8 col-md-7" style="padding-left:9%; width: 92.666667%;">
                <div class="card" id="links">
                    <div class="header">
                        <h4 class="title">Affiliate Links</h4>
                    </div>
                    <div class="content">

                        <div class="row">
                            <div class="col-md-12">
                                <div class="form-group">
                                    <label>Link</label>
                                    <input type="text" class="form-control border-input" value="http://eventserica.com/?AffiliateLinkId=@Model.AffiliateLinkId" disabled>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12">
                                <div class="form-group">
                                    <label>Short URL</label>
                                    <input type="text" class="form-control border-input" placeholder="Tiny URL" value="@Model.ShortURL" disabled>
                                </div>
                            </div>
                        </div>

                        @*<div class="text-center">
                            <button type="submit" id="GenerateLink" class="btn btn-info btn-fill btn-wd">Update Profile</button>
                        </div>*@
                        <div class="clearfix"></div>

                    </div>
                </div>
                <div class="card" id="reset">
                    <div class="header">
                        <h4 class="title">Reset Password</h4>
                    </div>
                    <div class="content">
                        <div class="form-group">
                            <label  id="invalidInput" style="font-size:20px;font-weight:600"></label>
                        </div>

                        @*@if (ViewBag.ResetMessage != null)
                        {
                            <div class="form-group">
                                <label style="color:forestgreen;" id="valid">@ViewBag.ResetMessage</label>
                            </div>
                        }*@


                        <div class="row">
                            <div class="col-md-12">
                                <div class="form-group">
                                    <label>Current Password</label>
                                    <input type="password" id="CurrentPassword" name="CurrentPassword" class="form-control border-input" placeholder="Current Password">
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12">
                                <div class="form-group">
                                    <label>New Password</label>
                                    <input type="password" id="NewPassword" name="NewPassword" class="form-control border-input" placeholder="New Password">
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12">
                                <div class="form-group">
                                    <label>Confirm Password</label>
                                    <input type="password" id="ConfirmPassword" name="ConfirmPassword" class="form-control border-input" placeholder="Confrim Password">
                                </div>
                            </div>
                        </div>



                        <div class="text-center">
                            <button type="submit" id="ResetSubmit" class="btn btn-info btn-fill btn-wd">Update Password</button>
                        </div>
                        <div class="clearfix"></div>

                    </div>
                </div>

                <div class="card" id="details">
                    <div class="header">
                        <h4 class="title">User Details</h4>
                    </div>
                    <div class="content">

                        <div class="form-group">
                            <label style="color:red;font-size:20px;font-weight:600;" id="invalidUserInput" ></label>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label>Name</label>
                                    <input type="text" id="UserName" name="UserName" class="form-control border-input" value="" onkeydown="return ((event.keyCode >= 65 && event.keyCode <= 120) || (event.keyCode == 32) || (event.keyCode == 8) || (event.keyCode == 9) || (event.keyCode == 37) || (event.keyCode == 38) || (event.keyCode == 39)); ">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label>Gender</label>
                                    <select class="form-control border-input" name="Gender" id="Gender"  >
                                        <option selected="" hidden="">Select</option>
                                        <option value="Female">Female</option>
                                        <option value="Male">Male</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                           <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label>Phone No</label>
                                    <input type="text" id="PhoneNo" name="PhoneNo" class="form-control border-input" maxlength="10" value="" onkeypress="return isNumber(event)" />
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label>City</label>
                                    <input type="text"  id="City" name="City" class="form-control border-input" value=""onkeydown="return ((event.keyCode >= 65 && event.keyCode <= 120) || (event.keyCode == 32) || (event.keyCode == 8) || (event.keyCode == 9) || (event.keyCode == 37) || (event.keyCode == 38) || (event.keyCode == 39)); ">
                                </div>
                            </div>
                        </div>


                        <div class="text-center">
                            <button type="submit" id="UserSubmit" class="btn btn-info btn-fill btn-wd">Update Profile</button>
                        </div>
                        <div class="clearfix"></div>

                    </div>
                </div>
            </div>



        </div>
    </div>
</div>
<script>
    window.onload = function () {
        showLinks();
    };


    function showLinks() {
        var x = document.getElementById("details");
        var y = document.getElementById("reset");
        var z = document.getElementById("links");
        var card = document.getElementById("card1");

        x.style.display = "none";
        y.style.display = "none";
        z.style.display = "block";


    }
    function showReset() {
        var x = document.getElementById("details");
        var y = document.getElementById("links");
        var z = document.getElementById("reset");
        var card = document.getElementById("card2");

        x.style.display = "none";
        y.style.display = "none";
        z.style.display = "block";

    }
    function showDetails() {
        var x = document.getElementById("reset");
        var y = document.getElementById("links");
        var z = document.getElementById("details");
        var card = document.getElementById("card3");


        x.style.display = "none";
        y.style.display = "none";
        z.style.display = "block";

    }

</script>
<script src="http://code.jquery.com/jquery-1.9.1.js"></script>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min.js"></script>
<script>
    $(document).ready(function () {
        $("#ResetSubmit").click(function () {
            var currentpwd = $("#CurrentPassword").val();
            var newpwd = $("#NewPassword").val();
            var confirmpwd = $("#ConfirmPassword").val();
            if (currentpwd == '' || newpwd == '' || confirmpwd == '')
            {
                $("#invalidInput").text("Please fill all the fields").css("color","red");
            return false;
            }
            if (newpwd != confirmpwd) {
                $("#invalidInput").text("Password Mismatch").css("color", "red");
                return false;
            }
            $.ajax({
                url: "/Settings/ResetPassword",
                type: "POST",
                data: {

                    CurrentPassword: $("#CurrentPassword").val(),
                    NewPassword: $("#NewPassword").val(),
                    ConfirmPassword: $("#ConfirmPassword").val()

                },
                dataType: "json",
                success: function (response) {
                    
                    if (response == "success")
                        $('#invalidInput').text("Password Reset Successful").css("color","#81f381");
                    else
                        $('#invalidInput').text("Current Password is wrong").css("color", "red");
                    return false;
                },
                error: function (response) {
                    alert(response.responseText);

                }
            });
            

        });



        $("#UserSubmit").click(function () {
            var UserName= $("#UserName").val();
            var Gender= $("#Gender").val();
           var PhoneNo= $("#PhoneNo").val();
           var City= $("#City").val();

            if (UserName == '' || Gender == '' || PhoneNo == '' || City == '')
            {

                $('#invalidUserInput').text("Please Fill all the fields").css("color","red");
                return false;
            }
            var IndNum = /^[0]?[6789]\d{9}$/;
            if (!IndNum.test(PhoneNo)) {
                $('#invalidUserInput').text("Invalid Mobile Number").css("color", "red");
                return false;
            }
           

            $.ajax({
                url: "/Settings/UpdateUser",
                type: "POST",
                data: {

                    UserName: $("#UserName").val(),
                    Gender: $("#Gender").val(),
                    PhoneNo: $("#PhoneNo").val(),
                    City : $("#City").val()

                },
                dataType: "json",
                success: function (response) {

                    if (response == "Success") 
                    {
                        $('#invalidUserInput').text("User Detail updated successfully").css("color", "#81f381");
                    }
                    else
                        $('#invalidUserInput').text("Please try Again").css("color", "red");   
                },
                error: function (response) {
                    alert(response.responseText);

                }
                    
                
            });


        });
    });


    $(window).bind("load", function () {
        $.ajax({
            type: "POST",
            url: "/Settings/GetUserDetails",
            data: {

            },
            dataType: "json",
            success: function (data) {

                $("#UserName").val(data.UserName);
                $("#PhoneNo").val(data.PhoneNo);
                $("#Gender").val(data.Gender);
                $("#City").val(data.City);
                

            }
            ,
            error: function (response) {
                alert(response.responseText);

            }
        });
    });
    function isNumber(evt) {
        evt = (evt) ? evt : window.event;
        var charCode = (evt.which) ? evt.which : evt.keyCode;
        if (charCode > 31 && (charCode < 48 || charCode > 57)) {
            return false;
        }
        return true;
    }

    function lettersOnly(evt) {
        evt = (evt) ? evt : event;
        var charCode = (evt.charCode) ? evt.charCode : ((evt.keyCode) ? evt.keyCode :
            ((evt.which) ? evt.which : 0));
        if (charCode > 31 && (charCode < 65 || charCode > 90) &&
            (charCode < 97 || charCode > 122)) {
            return false;
        }
        return true;
    }
    //function mobileNumber(mobile)
    //{
    //    var IndNum = /^[0]?[6789]\d{9}$/;
    //    if (!IndNum.test(mobile))
    //    {
    //        $('#invalidUserInput').text("Invalid Mobile Number").css("color","red");
    //        return false;
    //    }
    //    return true;
    //}
</script>